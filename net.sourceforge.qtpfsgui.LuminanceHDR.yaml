app-id: net.sourceforge.qtpfsgui.LuminanceHDR
runtime: org.kde.Platform
runtime-version: "5.11"
sdk: org.kde.Sdk
command: luminance-hdr
rename-icon: luminance-hdr
finish-args:
  - --socket=fallback-x11
  - --share=ipc
  - --filesystem=home
  - --share=network
  - --device=dri
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /lib/*.a
  - /lib/*.la
  - /share/aclocal
modules:
  - name: exiv2
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/Exiv2/exiv2/
        commit: e7ffd83af29187190da7f98dcbca8a4d70e19582
    cleanup:
      - /bin
      - /share/man

  - name: fftw3
    buildsystem: autotools
    config-opts:
      - --enable-float
      - --enable-threads
      - --enable-openmp
      - --disable-fortran
    sources:
      - type: archive
        url: http://fftw.org/fftw-3.3.8.tar.gz
        md5: 8aac833c943d8e90d51b697b27d4384d
    cleanup:
      - /bin
      - /share/info
      - /share/man

  - name: ilmbase
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://download.savannah.nongnu.org/releases/openexr/ilmbase-2.2.1.tar.gz
        sha256: cac206e63be68136ef556c2b555df659f45098c159ce24804e9d5e9e0286609e

  - name: openexr
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://download.savannah.nongnu.org/releases/openexr/openexr-2.2.1.tar.gz
        sha256: 8f9a5af6131583404261931d9a5c83de0a425cb4b8b25ddab2b169fbf113aecd
    cleanup:
      - /bin
      - /share/doc

  - name: boost
    buildsystem: simple
    build-commands:
      - "./bootstrap.sh --prefix=/app --with-libraries=atomic,chrono,date_time,filesystem,iostreams,program_options,system,thread"
      - "./b2 -j $FLATPAK_BUILDER_N_JOBS install"
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.bz2
        sha256: 7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7

  - name: libraw
    buildsystem: autotools
    config-opts:
     - --disable-examples
     - --disable-static
    sources:
      - type: archive
        url: https://www.libraw.org/data/LibRaw-demosaic-pack-GPL2-0.18.8.tar.gz
        sha256: 0b24bcf7bbb5d13fde58bb071f94dc9354be09bc44b2bba0698493065e99f8da
        dest: ./LibRaw-demosaic-pack-GPL2
      - type: archive
        url: https://www.libraw.org/data/LibRaw-demosaic-pack-GPL3-0.18.8.tar.gz
        sha256: ffd6916cd66c8101e4e6b589799f256c897748d2fd2486aa34c3705146dbc701
        dest: ./LibRaw-demosaic-pack-GPL3
      - type: archive
        url: https://www.libraw.org/data/LibRaw-0.18.13.tar.gz
        sha256: cb1f9d0d1fabc8967d501d95c05d2b53d97a2b917345c66553b1abbea06757ca
    cleanup: [/share/doc]

  - name: gsl
    sources:
      - type: archive
        url: http://ftp.halifax.rwth-aachen.de/gnu/gsl/gsl-2.3.tar.gz
        sha256: 562500b789cd599b3a4f88547a7a3280538ab2ff4939504c8b4ac4ca25feadfb
    cleanup:
      - /bin
      - /share/info
      - /share/man

  - name: cfitsio
    make-args: [shared]
    sources:
      - type: archive
        url: http://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/cfitsio3450.tar.gz
        sha256: bf6012dbe668ecb22c399c4b7b2814557ee282c74a7d5dc704eb17c30d9fb92e

  # ==============================
  # align_image_stack dependencies
  # ==============================
  - name: vigra
    buildsystem: cmake-ninja
    config-opts:
       - -DWITH_OPENEXR=ON
    sources:
      - type: archive
        url: https://github.com/ukoethe/vigra/archive/Version-1-9-0.tar.gz
        sha256: dc041f7ccf838d4321e9bcf522fece1758768dd7a3f8350d1e83e2b8e6daf1e6

  - name: glew
    no-autogen: true
    make-args: &glew-make-args
      - "GLEW_PREFIX=/app"
      - "GLEW_DEST=/app"
      - "LIBDIR=/app/lib"
    make-install-args: *glew-make-args
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/glew/glew/2.1.0/glew-2.1.0.tgz
        sha256: 04de91e7e6763039bc11940095cd9c7f880baba82196a7765f727ac05a993c95

  - name: glu
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.0.tar.bz2
        sha256: 1f7ad0d379a722fcbd303aa5650c6d7d5544fde83196b42a73d1193568a4df12
    cleanup: ["/include", "/lib/*.a", "/lib/*.la", "/lib/pkgconfig"]

  - name: wxWidgets
    cleanup:
      - /bin
      - /share/bakefile
    config-opts:
      - --with-opengl
      - --with-libjpeg
      - --with-libtiff
      - --with-libpng
      - --with-zlib
      - --disable-sdltest
      - --enable-unicode
      - --enable-display
      - --enable-propgrid
      - --disable-webkit
      - --disable-webview
      - --disable-webviewwebkit
      - --with-expat=builtin
      - --with-libiconv=/usr
    build-options:
      cxxflags: "-std=c++0x"
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.4/wxWidgets-3.0.4.tar.bz2
        sha256: 96157f988d261b7368e5340afa1a0cad943768f35929c22841f62c25b17bf7f0

  - name: libpano13
    buildsystem: cmake
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/panotools/libpano13/libpano13-2.9.19/libpano13-2.9.19.tar.gz
        sha256: 037357383978341dea8f572a5d2a0876c5ab0a83dffda431bd393357e91d95a8

  - name: align_image_stack
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/hugin/hugin/hugin-2018.0/hugin-2018.0.0.tar.bz2
        sha256: d3af0d066ac50e3bb243a175a64ecda136d87178419457e8822e11bcf0e565cb
      #- type: patch
        #path: patches/hugin.patch

  - name: luminance
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/LuminanceHDR/LuminanceHDR/archive/v.2.5.1.tar.gz
        sha256: 07c02b85a09be1cc4c8940d55a7a2f24c55a071904fedf7c81e621fd0f0ba878
      - type: file
        path: net.sourceforge.qtpfsgui.LuminanceHDR.appdata.xml
      - type: file
        path: net.sourceforge.qtpfsgui.LuminanceHDR.desktop
      - type: file
        path: net.sourceforge.qtpfsgui.LuminanceHDR.svg
    post-install:
      - install -Dm 644 net.sourceforge.qtpfsgui.LuminanceHDR.appdata.xml -t /app/share/appdata
      - install -Dm 644 net.sourceforge.qtpfsgui.LuminanceHDR.desktop -t /app/share/applications
      - install -Dm 644 net.sourceforge.qtpfsgui.LuminanceHDR.svg -t /app/share/icons/hicolor/scalable/apps
    cleanup:
      # Remove unpatched appdata and desktop
      - /share/appdata/luminance-hdr.appdata.xml
      - /share/applications/luminance-hdr.desktop
